# 01. Scope and MVP Specification

## Основные принципы разработки
- **MVP-first**: Убираем за скобки всё, что не является критически важным.
- **Agentic Development**: Разработка опирается на работу с AI-агентами.
- **Spec-driven**: 
  - Основные источники истины — файлы `journal/XX_spec_name.md`. 
  - В них описываются архитектурные и продуктовые решения.
  - На эти спецификации опирается агент при написании кода.
  - Они служат основой для будущей документации.
- **Итерационный процесс**:
  1. Написание спецификации (specs).
  2. Запуск агента и ревью его плана.
  3. Ревью кода и результатов.
  4. Обновление specs.
  5. Запись в `journal/PROGRESS.md` после каждого значимого изменения.
- **Документация**: `README.md` и другие пользовательские документы создаются ближе к готовности MVP.

## Мы строим MVP

### Objective (Цель)
Создание устойчивого Telegram-бота, который:
1. Работает в групповых чатах.
2. Запоминает часовые пояса пользователей.
3. Отвечает расширенным сообщением на упоминание времени, конвертируя его для всех участников, чтобы обеспечить синхранизацию встреч.

### Architecture Overview

```
┌─────────────┐
│  Telegram   │
│   Group     │
└──────┬──────┘
       │ message
       ▼
┌──────────────────────────────────────────────────────┐
│                    BOT CORE                          │
│  ┌─────────┐   ┌─────────────┐   ┌───────────────┐   │
│  │ Capture │──▶│ Transform   │──▶│ Response      │   │
│  │ (Regex) │   │ (UTC-Pivot) │   │ (Format)      │   │
│  └─────────┘   └─────────────┘   └───────────────┘   │
│       │              │                   │           │
│       └──────────────┼───────────────────┘           │
│                      ▼                               │
│              ┌──────────────┐                        │
│              │   Storage    │                        │
│              │   (SQLite)   │                        │
│              └──────────────┘                        │
└──────────────────────────────────────────────────────┘
       │
       ▼ reply
┌─────────────┐
│  Telegram   │
│   Group     │
└─────────────┘
```


### Qualities (Качества)
- **Простота**: Не требует сложных действий от пользователя.
- **Детекция**: Распознавание триггерных сообщений основано на простой и надежной логике (Regex). (Опционально/Позже) Второй слой детекции Levenshtein distance (rapidfuzz).
- **Точность времени**: Трансформация времени должна быть устойчива к сезонным сдвигам и изменениям правил временных зон (использование IANA database).
- **Легкое администрирование**: высокоуровневый конфиг .yaml

## Technology Stack

| Component | Library | Purpose |
|-----------|---------|---------|
| **Core** | `python` (3.11+) | Runtime environment |
| **Bot API** | `aiogram` | Async Telegram Bot API wrapper |
| **Storage** | `aiosqlite` | Asynchronous SQLite interface |
| **Timezone** | `zoneinfo`, `tzdata` | IANA timezone database (std lib + data) |
| **Geocoding** | `geopy`, `timezonefinder` | City → Coords → Timezone |
| **Config** | `PyYAML`, `python-dotenv` | Configuration management |
| **Package Manager** | `uv` | Dependency & environment management |

## High-level Configuration (Конфигурация и поведение)


### Структура ответа
- Четко определенная схема сообщения.
- Единый формат времени.
- **Обработка дат**: Включение дополнительной пометки, если для кого-то время переходит на следующий календарный день.
- **Группировка**: Если у пользователей совпадают часовые пояса, показывать время один раз, перечисляя города через запятую.

### Алгоритм (Draft)
1. Regex детекция времени.
2. (Опционально/Позже) Второй слой детекции (rapidfuzz).
3. Любая конвертация идёт через UTC, прямые Local→Local запрещены.

## Out of Scope (За рамками текущего MVP)
- Активное подтверждение действий пользователя (переспрашивание/уточнение геолокации).
- LLM fallbacks
- поддержка других мессэнджерев (Discord, WhatsUp)
- Не закладываем абстракцию для Discord/WhatsApp в MVP.
- если в сообщении больше одного времени - бот выдает несколько корректирующих сообщений - объединение в одно пока-что не реализуем

## Constraints (Чего делать не надо)
- **No Hardcode**: Никакого хардкода городов и часовых поясов в коде.
- **No LLM Fallbacks**: Не используем LLM в рантайме для распознавания (дорого/медленно).
- **No private chats** No need to talk to this bot one-to-one 
---


# 02. Capture Logic Specification

Эта спецификация описывает логику обнаружения временных меток в сообщениях пользователей.
Мы используем **Strict Regex Layer** как основной и единственный метод для MVP.

```
Message ──▶ [Regex Patterns] ──▶ Match?
                                   │
                        ┌──────────┴──────────┐
                        ▼                     ▼
                       Yes                   No
                        │                     │
                        ▼                     ▼
              ["19:00", "5 pm"]            (skip)
                        │ 
                        ▼
              → Transform Module
```

## 1. Концепция
Агент должен сканировать входящие сообщения на наличие паттернов времени.
Если сообщение содержит одно или несколько совпадений, они извлекаются и передаются на следующий этап (конвертация).


## 2. Поддерживаемые форматы времени (Regex Patterns)

1.  **ISO-like / 24h format**: `HH:MM`
    *   Примеры: `19:00`, `09:30`, `14:15`
2.  **12h format**: `H:MM AM/PM` или `H AM/PM` или `HH AM/PM`
    *   Примеры: `5 PM`, `05:00 pm`, `10 am`, `9:30 PM` (регистр не важен)


### Игнорирование
*   Мы **не** триггеримся на просто числа (`19`, `5`). Обязательно наличие разделителя `:` или маркера `am/pm`.

### Примеры Regex
> **Note:** Точные паттерны вынесены в `configuration.yaml`.

*   `\b([0-1]?[0-9]|2[0-3]):([0-5][0-9])\b` — для `HH:MM`
*   `\b((1[0-2]|0?[1-9]):([0-5][0-9]) ?([AaPp][Mm]))\b` — для `12h` c минутами
*   `\b((1[0-2]|0?[1-9]) ?([AaPp][Mm]))\b` — для `12h` без минут (например `5 pm`)

## 3. Обработка множественных значений
Если в сообщении встречается несколько временных меток, бот должен извлечь их все.

**Сценарий:**
> "Давайте созвонимся в 18:00 или лучше в 19:30?"

**Результат парсинга:**
`["18:00", "19:30"]`

Бот должен будет сконвертировать каждое из этих времен.

## 4. Примеры срабатываний (Test Cases)

| Сообщение пользователя | Ожидаемый результат (список) | Комментарий |
| :--- | :--- | :--- |
| `Meeting at 15:00` | `["15:00"]` | Чистое совпадение 24h |
| `го в 19:00` | `["19:00"]` | Игнорируем предлог, берем время |
| `Call me at 5 pm` | `["5 pm"]` | 12h формат |
| `10:30 am or 11:30 am` | `["10:30 am", "11:30 am"]` | Множественное время |
| `Созвон в 14:00 по МСК` | `["14:00"]` | "по МСК" парсится отдельно или игнорируется на этом этапе (MVP: берем 14:00 как локальное время юзера) |
| `Цена 500` | `[]` | Не время |
| `Счет 12:45` | `["12:45"]` | **Edge Case**: похоже на счет в матче или коэффициент. Regex сработает. (Принимаем этот риск для MVP) |

## 5. Инструкции для реализации
1. Использовать модуль `re` в Python.
2. Вынести список регулярных выражений в configuration.yaml (конфигурационый файл). 
3. Функция `extract_time_strings(text: str) -> List[str]` возвращает список найденных сырых строк.
